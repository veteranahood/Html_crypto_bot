

## **Step 8: Setup Scripts**

### **8.1 Setup Script**
Create `scripts/setup.sh`:

```bash
#!/bin/bash

# Crypto Trading Bot Setup Script
# Run: curl -L https://raw.githubusercontent.com/YOUR-USERNAME/crypto-trading-bot/main/scripts/setup.sh | bash

set -e

echo "üöÄ Crypto Trading Bot Setup"
echo "============================="

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Check if running as root
if [ "$EUID" -eq 0 ]; then 
    echo -e "${RED}Please do not run as root${NC}"
    exit 1
fi

# Detect OS
OS=""
if [ -f /etc/os-release ]; then
    . /etc/os-release
    OS=$NAME
elif type lsb_release >/dev/null 2>&1; then
    OS=$(lsb_release -si)
fi

echo -e "${GREEN}Detected OS: $OS${NC}"

# Function to install packages
install_packages() {
    echo -e "${YELLOW}Updating package lists...${NC}"
    sudo apt-get update -qq
    
    echo -e "${YELLOW}Installing required packages...${NC}"
    sudo apt-get install -y -qq \
        curl \
        wget \
        git \
        build-essential \
        software-properties-common \
        apt-transport-https \
        ca-certificates \
        gnupg \
        lsb-release
}

# Function to install Node.js
install_nodejs() {
    if ! command -v node &> /dev/null; then
        echo -e "${YELLOW}Installing Node.js 18...${NC}"
        curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
        sudo apt-get install -y -qq nodejs
        
        echo -e "${YELLOW}Installing yarn...${NC}"
        sudo npm install -g yarn
    else
        echo -e "${GREEN}Node.js already installed${NC}"
    fi
}

# Function to install Docker
install_docker() {
    if ! command -v docker &> /dev/null; then
        echo -e "${YELLOW}Installing Docker...${NC}"
        curl -fsSL https://get.docker.com | sudo sh
        
        echo -e "${YELLOW}Adding user to docker group...${NC}"
        sudo usermod -aG docker $USER
        
        echo -e "${YELLOW}Installing Docker Compose...${NC}"
        sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" \
            -o /usr/local/bin/docker-compose
        sudo chmod +x /usr/local/bin/docker-compose
    else
        echo -e "${GREEN}Docker already installed${NC}"
    fi
}

# Function to install MongoDB
install_mongodb() {
    if ! command -v mongod &> /dev/null; then
        echo -e "${YELLOW}Installing MongoDB...${NC}"
        wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo apt-key add -
        echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | \
            sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list
        sudo apt-get update -qq
        sudo apt-get install -y -qq mongodb-org
        
        echo -e "${YELLOW}Starting MongoDB...${NC}"
        sudo systemctl start mongod
        sudo systemctl enable mongod
    else
        echo -e "${GREEN}MongoDB already installed${NC}"
    fi
}

# Function to install Redis
install_redis() {
    if ! command -v redis-server &> /dev/null; then
        echo -e "${YELLOW}Installing Redis...${NC}"
        sudo apt-get install -y -qq redis-server
        
        echo -e "${YELLOW}Configuring Redis...${NC}"
        sudo sed -i 's/supervised no/supervised systemd/g' /etc/redis/redis.conf
        sudo sed -i 's/bind 127.0.0.1 ::1/bind 0.0.0.0/g' /etc/redis/redis.conf
        
        echo -e "${YELLOW}Starting Redis...${NC}"
        sudo systemctl restart redis
        sudo systemctl enable redis
    else
        echo -e "${GREEN}Redis already installed${NC}"
    fi
}

# Function to install Nginx
install_nginx() {
    if ! command -v nginx &> /dev/null; then
        echo -e "${YELLOW}Installing Nginx...${NC}"
        sudo apt-get install -y -qq nginx
        
        echo -e "${YELLOW}Configuring firewall...${NC}"
        sudo ufw allow 'Nginx Full'
        sudo ufw allow 'OpenSSH'
        sudo ufw --force enable
    else
        echo -e "${GREEN}Nginx already installed${NC}"
    fi
}

# Function to setup project
setup_project() {
    echo -e "${YELLOW}Setting up project...${NC}"
    
    # Clone if not already cloned
    if [ ! -d "crypto-trading-bot" ]; then
        git clone https://github.com/YOUR-USERNAME/crypto-trading-bot.git
    fi
    
    cd crypto-trading-bot
    
    # Setup backend
    echo -e "${YELLOW}Setting up backend...${NC}"
    cd backend
    cp .env.example .env
    
    echo -e "${YELLOW}Please edit .env file with your configuration${NC}"
    echo -e "${YELLOW}Press Enter when ready...${NC}"
    read
    
    npm install
    
    # Setup frontend
    echo -e "${YELLOW}Setting up frontend...${NC}"
    cd ../frontend
    npm install
    
    cd ..
}

# Function to create systemd service
create_service() {
    echo -e "${YELLOW}Creating systemd service...${NC}"
    
    sudo tee /etc/systemd/system/crypto-trading-bot.service > /dev/null <<EOF
[Unit]
Description=Crypto Trading Bot
After=network.target mongod.service redis.service
Requires=mongod.service redis.service

[Service]
Type=simple
User=$USER
WorkingDirectory=/home/$USER/crypto-trading-bot/backend
Environment=NODE_ENV=production
ExecStart=/usr/bin/npm start
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
SyslogIdentifier=crypto-trading-bot

# Security
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=read-only
ReadWritePaths=/home/$USER/crypto-trading-bot/backend/data
ReadWritePaths=/home/$USER/crypto-trading-bot/backend/logs

[Install]
WantedBy=multi-user.target
EOF
    
    sudo systemctl daemon-reload
    sudo systemctl enable crypto-trading-bot
}

# Function to setup SSL
setup_ssl() {
    echo -e "${YELLOW}Setting up SSL certificate...${NC}"
    
    if ! command -v certbot &> /dev/null; then
        sudo apt-get install -y -qq certbot python3-certbot-nginx
    fi
    
    echo -e "${YELLOW}Please enter your domain name (e.g., trading.yourdomain.com):${NC}"
    read DOMAIN
    
    if [ -z "$DOMAIN" ]; then
        echo -e "${RED}Domain name is required for SSL${NC}"
        return
    fi
    
    sudo certbot --nginx -d $DOMAIN -d www.$DOMAIN --non-interactive --agree-tos \
        -m admin@$DOMAIN --redirect --hsts --uir
    
    echo -e "${GREEN}SSL certificate installed for $DOMAIN${NC}"
}

# Function to display success message
show_success() {
    echo -e "${GREEN}===================================${NC}"
    echo -e "${GREEN}‚úÖ Setup Completed Successfully!${NC}"
    echo -e "${GREEN}===================================${NC}"
    echo ""
    echo -e "${YELLOW}Next Steps:${NC}"
    echo "1. Edit backend/.env with your configuration"
    echo "2. Start the service: sudo systemctl start crypto-trading-bot"
    echo "3. Check status: sudo systemctl status crypto-trading-bot"
    echo "4. View logs: sudo journalctl -u crypto-trading-bot -f"
    echo "5. Access at: http://localhost:3000 or https://$DOMAIN"
    echo ""
    echo -e "${YELLOW}For Docker setup:${NC}"
    echo "cd crypto-trading-bot"
    echo "docker-compose up -d"
    echo ""
    echo -e "${YELLOW}Need help?${NC}"
    echo "üìö Documentation: https://github.com/YOUR-USERNAME/crypto-trading-bot/docs"
    echo "üêõ Issues: https://github.com/YOUR-USERNAME/crypto-trading-bot/issues"
    echo "üí¨ Discord: [Your Discord Link]"
}

# Main execution
main() {
    install_packages
    install_nodejs
    install_docker
    install_mongodb
    install_redis
    install_nginx
    setup_project
    create_service
    
    echo -e "${YELLOW}Do you want to setup SSL with Let's Encrypt? (y/n)${NC}"
    read SETUP_SSL
    if [[ $SETUP_SSL =~ ^[Yy]$ ]]; then
        setup_ssl
    fi
    
    show_success
}

# Run main function
main
